<!DOCTYPE html><html lang="ko" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="JUNIT in egov" /><meta property="og:locale" content="ko" /><meta name="description" content="JUNIT" /><meta property="og:description" content="JUNIT" /><link rel="canonical" href="https://redbean88.github.io/posts/junit/" /><meta property="og:url" content="https://redbean88.github.io/posts/junit/" /><meta property="og:site_name" content="dev note" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-11T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JUNIT in egov" /><meta name="twitter:site" content="@redbean88" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-13T00:24:28+09:00","datePublished":"2020-11-11T00:00:00+09:00","description":"JUNIT","headline":"JUNIT in egov","mainEntityOfPage":{"@type":"WebPage","@id":"https://redbean88.github.io/posts/junit/"},"url":"https://redbean88.github.io/posts/junit/"}</script><title>JUNIT in egov | dev note</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="dev note"><meta name="application-name" content="dev note"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-384x384.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">dev note</a></div><div class="site-subtitle font-italic">학습한것을 기록합니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/redbean88" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/redbean88" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['doctortor88','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JUNIT in egov</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JUNIT in egov</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> redbean88 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Nov 11, 2020, 12:00 AM +0900" >Nov 11, 2020<i class="unloaded">2020-11-11T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 13, 2021, 12:24 AM +0900" >Dec 13, 2021<i class="unloaded">2021-12-13T00:24:28+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1706 words">9 min read</span></div></div><div class="post-content"><h1 id="junit">JUNIT</h1><ol><li>테스트 코드 작업을 지원하는 라이브러리로 java 진영 뿐 아니라, xUnit 형태로 다른 언어도 지원<ul><li><img data-proofer-ignore data-src="https://redbean88.github.io/img/junit.ucd.jpg" alt="이미지" /><li>러너 - 테스트를 실행<li>스위트 - 여러 테스트 클래스를 묶는 그룹<li>테스트 클래스 - 여러 테스트를 포함한 클래스</ul><li>Mock<ul><li>not real but appearing or pretending to be exactly like something<li>진짜처럼 모습을 가장하는 것<li>테스트에서는 구현하기 힘들거나, 어려운 객체를 <strong>가장</strong>하는 객체를 의미<li>이러한 기능은 지원하는 라이브러리는 여러가지가 있으나, 아래에서는 eazymock이라는 라이브러리를 이용</ul></ol><h3 id="pomxml">pom.xml</h3><div class="language-xml highlighter-rouge"><div class="code-header"> <span text-data=" XML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre> 		<span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.4<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
 
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.easymock<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>easymock<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.4<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
 
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.easymock<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>easymockclassextension<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.4<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
 
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.dbunit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>dbunit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.4.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
 
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.unitils<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>unitils<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</pre></table></code></div></div><blockquote><p>테스트에서만 사용하기 위해, <scope> 속성을 test로 설정</scope></p></blockquote><h2 id="서비스-레이어-테스트">서비스 레이어 테스트</h2><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">egovframework.com.org.onnara.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">easymock</span><span class="o">.</span><span class="na">EasyMock</span><span class="o">.</span><span class="na">expect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">easymock</span><span class="o">.</span><span class="na">EasyMock</span><span class="o">.</span><span class="na">verify</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.UnitilsJUnit4TestClassRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.easymock.EasyMockUnitils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.easymock.annotation.Mock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.inject.annotation.InjectIntoByType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.inject.annotation.TestedObject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">egovframework.com.cmm.EgovMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">egovframework.com.org.syn.service.EgovOrgnztSync</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">egovframework.com.org.syn.service.impl.EgovOrgnztSyncServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">egovframework.rte.fdl.property.EgovPropertyService</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">UnitilsJUnit4TestClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnnaraUserMngServiceImplTestByBase</span> <span class="o">{</span>
	
	<span class="nd">@Mock</span>
	<span class="nd">@InjectIntoByType</span>
    <span class="kd">protected</span> <span class="nc">EgovPropertyService</span> <span class="n">propertyService</span><span class="o">;</span>
	
	<span class="nd">@Mock</span>
	<span class="nd">@TestedObject</span>
	<span class="kd">private</span> <span class="nc">EgovOrgnztSyncServiceImpl</span> <span class="n">syncService</span><span class="o">;</span>
	
	<span class="nd">@Before</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">(){</span>
		<span class="n">syncService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EgovOrgnztSyncServiceImpl</span><span class="o">();</span>
	<span class="o">}</span>
	
	<span class="nd">@Test</span>
	<span class="cm">/**
	 * baseUserInfoSetting
	 * @throws Exception
	 */</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="n">기본정보_미존재시_기본값_설정처리_확인</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="c1">//녹화</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultEamilAdres"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultOffmTelno"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultFxnum"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultOrgnztZip"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultOrgnztAdres"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">expect</span><span class="o">(</span><span class="n">propertyService</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"Globals.orgSyncUserDefaultOrgnztAdres2"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="c1">//재생</span>
		<span class="nc">EasyMockUnitils</span><span class="o">.</span><span class="na">replay</span><span class="o">();</span>
		<span class="nc">EgovOrgnztSync</span> <span class="n">testegovOrgnztSync</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EgovOrgnztSync</span><span class="o">();</span>
		<span class="n">syncService</span><span class="o">.</span><span class="na">baseUserInfoSetting</span><span class="o">(</span><span class="n">testegovOrgnztSync</span><span class="o">);</span>
		<span class="c1">//검증</span>
		<span class="n">verify</span><span class="o">(</span><span class="n">propertyService</span><span class="o">);</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"이메일정보"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getEmailAdres</span><span class="o">());</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"부서연락처"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getOrgnztTelno</span><span class="o">());</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"부서팩스"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getOrgnztFaxno</span><span class="o">());</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"우편번호"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getOrgnztZip</span><span class="o">());</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"주소"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getOrgnztAdres</span><span class="o">());</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"주소2"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">,</span> <span class="n">testegovOrgnztSync</span><span class="o">.</span><span class="na">getOrgnztAdres2</span><span class="o">());</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th style="text-align: left">대상<th>설명<tbody><tr><td style="text-align: left">@RunWith(UnitilsJUnit4TestClassRunner.class)<td>사용 러너를 설정한다<tr><td style="text-align: left">@Mock<td>Mock객체임을 선언<tr><td style="text-align: left">@InjectIntoByType<td>테스트될 서비스에 주입되는 의존성을 설정해준다. unitils에서 지원하는 기능<tr><td style="text-align: left">@TestedObject<td>테스트 대상 서비스를 선언<tr><td style="text-align: left">@Before<td>매 테스트가 실행시, 초기화 시켜줄 method에 붙인다.<tr><td style="text-align: left">@Test<td>테스트 메소드에 붙인다.<tr><td style="text-align: left">assert*<td>단언문으로 해당 테스트를 검증 가능하다. 위에서는 assertEquals를 사용하여 검증을 진행</table></div><h2 id="easymock">easyMock</h2><blockquote><p>easyMock의 프로세스 흐흠은 [녹화 &gt; 재생 &gt; 검증 ]으로, 진행된다.</p><ul><li>녹화<ul><li>테스트하기위한 프로세스를 설정하는 단계로, 기대되는 프로세스를 미리 지정하여 검증이 가능하도록 할 수 있다.<li>expect([method]).andReturn([value]) // 구현중이거나, 외부 API를 테스트하기위해, 특정 method를 호출시 반환값을 설정한다.</ul><li>재생<ul><li>녹화된 프로세스를 재생하는 기능<li><strong>반드시</strong> 재생 후, 테스트 대상 메소드를 실행</ul><li>검증<ul><li>verify([target]) 으로 녹화된 프로세스 테스트</ul></ul></blockquote><h2 id="unitls">Unitls</h2><blockquote><p>eazymock의 부족한 기능을 보완하는 라이브러리</p><ul><li>실 서비스에서 의존성을 주입받는 구현체를 적절하게 주입해준다</ul></blockquote><h2 id="dto-레이어-테스트">DTO 레이어 테스트</h2><blockquote><p>DB 테스트를 위해서는 DB 접속 정보, 타입등의 정보를 미리 설정해 주어야 한다. unitils에서 제공하는 기능을 통해 간단하게 설정 가능.</p></blockquote><blockquote><p>[projectName]/src/test/resources/unitils.properties</p></blockquote><div class="language-xml highlighter-rouge"><div class="code-header"> <span text-data=" XML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>
# Properties for the PropertiesDataSourceFactory
# PropertiesDataSourceFactory 설정
database.driverClassName=oracle.jdbc.driver.OracleDriver
database.url=jdbc:oracle:thin:@192.168.200.225:1521:sfep
database.userName=seogu
database.password=sfseogu

# 테스트시 적용한 트렌젝션 처리를 설정, 지원하는 설정값은 'disabled', 'commit', 'rollback'.
# disabled 사용시, 트렌젝션 처리를 하지 않는다.
# commit 사용시, commit 처리를 진행 한다.
# rollback 사용시, 매 테스트 마다 rollback 처리를 진행한다
DatabaseModule.Transactional.value.default=rollback

# DataSet, ExpectedDataSet 사용을 위한 dms 정보 설정 ( 'oracle', 'db2', 'mysql', 'hsqldb', 'postgresql' )
database.dialect=oracle
# 스키마 이름 설정
database.schemaNames=SEOGU
# 트랜잭션 매니저 설정 ( 'auto', 'spring', 'simple' )
transactionManager.type=auto
# 테이블 자동 생성 등의 스키마 관리 기능 사용 여부 및 DML 위치 설정
#updateDataBaseSchema.enabled=true
#dbMaintainer.script.locations=src/test/resources/META-INF/persistence/maintenance/oracle
#dbMaintainer.disableConstraints.enabled=true
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">egovframework.com.org.syn.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.UnitilsJUnit4TestClassRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.database.annotations.TestDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.database.annotations.Transactional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.database.util.TransactionMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.spring.annotation.SpringApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.unitils.spring.annotation.SpringBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">egovframework.com.cmm.ComDefaultVO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">egovframework.com.org.syn.service.EgovOrgnztSync</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">UnitilsJUnit4TestClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="nc">TransactionMode</span><span class="o">.</span><span class="na">ROLLBACK</span><span class="o">)</span>
<span class="nd">@SpringApplicationContext</span><span class="o">({</span>
	<span class="s">"/spring/*.xml"</span><span class="o">,</span>
	<span class="s">"/egovframework/sqlmap/*.xml"</span><span class="o">,</span>
<span class="o">})</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EgovOrgnztSyncDaoTest</span><span class="o">{</span>
	
	<span class="cm">/**
	 * unitils.properties 에 설정 된 database 접근 정보를 기반으로 
	 * 테스트 용 DataSource 를 만든 후 자동으로 injection 해 준다.
	 * (unitils.properties 파일의 위치와 이름은 변경할 수 없다.)
	 * 
	 * updateDataBaseSchema.enabled=true 로 설정되어 있으면
	 * dbMaintainer.script.locations 에서 지정한 위치의 sql 문을 실행시켜준다.
	 * 주의) 생성 시점은 test 메소드가 실행되기 전이다.
	 *        따라서, 단순히 TestDataSource 만 선언하는 것이 아니라,
	 *        하나 이상의 test 메소드라도 있어야 결과 확인이 가능하다.
	 * 
	 * @see		unitils.properties
	 * @see      dbMaintainer.script.locations 에서 지정한 위치의 sql 문
	 */</span>
	<span class="nd">@TestDataSource</span>
	<span class="kd">private</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
	
	<span class="cm">/** 테스트를 위해 만든 타겟 클래스로서 공지사항 비즈니스 구현을 위한 Dao */</span>
	<span class="nd">@SpringBean</span><span class="o">(</span><span class="s">"egovOrgnztSyncDao"</span><span class="o">)</span>			<span class="c1">//위의 설정에서 의존성을 전부 주입해주지 않으면, spring bean 생성 오류가 발생</span>
	<span class="nc">EgovOrgnztSyncDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EgovOrgnztSyncDao</span><span class="o">();</span>
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="n">DB_연결확인</span><span class="o">(){</span>
		<span class="n">assertNotNull</span><span class="o">(</span><span class="s">"DB 연결 확인"</span><span class="o">,</span><span class="n">dataSource</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSelectDeptSyncCnt</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">ComDefaultVO</span> <span class="n">vo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ComDefaultVO</span><span class="o">();</span>
		<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">selectDeptSyncCnt</span><span class="o">(</span><span class="n">vo</span><span class="o">);</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"조회 건수"</span><span class="o">,</span> <span class="mi">0</span> <span class="o">,</span> <span class="n">result</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="cm">/**
	 * 사용자싱크 한건(USER_WORKER테이블 --&gt; COMTNEMPLYRINFO테이블로 적용)
	 * @throws Exception 
	 */</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="n">사용자_신규_등록</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">userId</span> <span class="o">=</span> <span class="s">"test"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">syncNo</span> <span class="o">=</span> <span class="s">"1"</span><span class="o">;</span>
		<span class="nc">EgovOrgnztSync</span> <span class="n">syncResult</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">userSyncProc</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="n">syncNo</span><span class="o">);</span>
		<span class="n">assertEquals</span><span class="o">(</span><span class="s">"신규등록성공"</span><span class="o">,</span> <span class="s">"Y"</span><span class="o">,</span><span class="n">syncResult</span><span class="o">.</span><span class="na">getInResult</span><span class="o">());</span>
		
	<span class="o">}</span>
	<span class="c1">// 동기화 이력 저장</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUserSyncResultUpdate</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">EgovOrgnztSync</span> <span class="n">selectUserSync</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EgovOrgnztSync</span><span class="o">();</span>
		<span class="n">selectUserSync</span><span class="o">.</span><span class="na">setSyncNo</span><span class="o">(</span><span class="s">"1"</span><span class="o">);</span>
		<span class="n">selectUserSync</span><span class="o">.</span><span class="na">setUserId</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
		<span class="n">selectUserSync</span><span class="o">.</span><span class="na">setInResult</span><span class="o">(</span><span class="s">"Y"</span><span class="o">);</span>
		<span class="n">dao</span><span class="o">.</span><span class="na">userSyncResultUpdate</span><span class="o">(</span><span class="n">selectUserSync</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>

</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th style="text-align: left">대상<th>설명<tbody><tr><td style="text-align: left">@RunWith(UnitilsJUnit4TestClassRunner.class)<td>사용 러너를 설정한다<tr><td style="text-align: left">@TestDataSource<td>DB 커넥션을 생성<tr><td style="text-align: left">@Transactional<td>트랜젝션 오류 발생시, 정책설정 (위에서는 ROLLBACK)<tr><td style="text-align: left">@SpringApplicationContext<td>설정 정보를 위치<tr><td style="text-align: left">@SpringBean([name])<td>스프링의 빈 팩토리에서 대상 빈을 주입해준다.</table></div><ul><li>일반 dto를 사용하듯이 사용후, 검증하면 된다.</ul><blockquote><p>롤백 부분은 아직 추가 검증이 필요하다.</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tdd/'>TDD</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JUNIT in egov - dev note&url=https://redbean88.github.io/posts/junit/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JUNIT in egov - dev note&u=https://redbean88.github.io/posts/junit/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=JUNIT in egov - dev note&url=https://redbean88.github.io/posts/junit/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/JPA-CH05/">자바 ORM 표준 JPA 프로그래밍(희망편05)</a><li><a href="/posts/JPA-CH06/">자바 ORM 표준 JPA 프로그래밍(희망편06)</a><li><a href="/posts/JPA-CH07/">자바 ORM 표준 JPA 프로그래밍(희망편07)</a><li><a href="/posts/JPA-CH09/">자바 ORM 표준 JPA 프로그래밍(희망편09)</a><li><a href="/posts/JPA-CH08/">자바 ORM 표준 JPA 프로그래밍(희망편08)</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/JPA-CH08/"><div class="card-body"> <span class="timeago small" >May 16, 2022<i class="unloaded">2022-05-16T22:20:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍(희망편08)</h3><div class="text-muted small"><p> Chapter 08. 값 타입 JPA의 데이터 타입을 가장 크게 분류하면 엔티티 타입과 값 타입으로 나눌 수 있다. 엔티티 타입은 @Entity로 정의하는 객체이고, 값 타입은 int, Integer, String처럼 단순히 값으로 사용하는 자바 기본 타입이나 객체를 말한다. 엔티티 타입은 식별자를 통해 지속해서 추적할 수 있지만, 값 타입은 추...</p></div></div></a></div><div class="card"> <a href="/posts/JPA-CH09/"><div class="card-body"> <span class="timeago small" >May 16, 2022<i class="unloaded">2022-05-16T21:20:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍(희망편09)</h3><div class="text-muted small"><p> Chapter 10. 객체지향 쿼리 언어 이장의 내용 객체지향 쿼리 소개 JPQL Criteria QueryDSL 네이티브 SQL 객체지향 쿼리 심화 9.1 객체지향 쿼리 소개 테이블이 아닌 객체를 대상으로 검색하는 객체지향 쿼리다. SQL을 추상화해서 특정 데이터베이스 SQ...</p></div></div></a></div><div class="card"> <a href="/posts/JPA-CH07/"><div class="card-body"> <span class="timeago small" >May 16, 2022<i class="unloaded">2022-05-16T21:20:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍(희망편07)</h3><div class="text-muted small"><p> Chapter 07. 프록시와 연관관계 관리 프록시와 즉시 로딩, 지연 로딩 영속성 전이와 고아 객체 7.1 프록시 엔티티를 조회할 때 연관된 엔티티들이 항상 사용되는 것은 아니다. printUserAndTeam() 메서드는 memberId로 회원 엔티티를 찾아서 연관된 팀의 이름도 출력한다. 반면 printUser...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/review/" class="btn btn-outline-primary" prompt="Older"><p>Review</p></a> <a href="/posts/whiteship-study-1week/" class="btn btn-outline-primary" prompt="Newer"><p>자바스터디 1주차</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://redbean88.github.io/posts/junit/'; this.page.identifier = '/posts/junit/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://redbean88-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://redbean88.github.io">redbean88</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LR635TNW07"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-LR635TNW07'); }); </script>
